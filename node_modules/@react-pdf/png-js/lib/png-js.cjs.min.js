"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("fs"),e=require("zlib");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=a(t),i=a(e),s=function(){function t(t){var e;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.text={};;){var a=this.readUInt32(),r="";for(e=0;e<4;e++)r+=String.fromCharCode(this.data[this.pos++]);switch(r){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"PLTE":this.palette=this.read(a);break;case"IDAT":for(e=0;e<a;e++)this.imgData.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(a);var i=255-this.transparency.indexed.length;if(i>0)for(e=0;e<i;e++)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":var s=this.read(a),h=s.indexOf(0),o=String.fromCharCode.apply(String,s.slice(0,h));this.text[o]=String.fromCharCode.apply(String,s.slice(h+1));break;case"IEND":switch(this.colorType){case 0:case 3:case 4:this.colors=1;break;case 2:case 6:this.colors=3}this.hasAlphaChannel=[4,6].includes(this.colorType);var n=this.colors+(this.hasAlphaChannel?1:0);switch(this.pixelBitlength=this.bits*n,this.colors){case 1:this.colorSpace="DeviceGray";break;case 3:this.colorSpace="DeviceRGB"}return void(this.imgData=Buffer.from(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}t.decode=function(e,a){return r.default.readFile(e,(function(e,r){return new t(r).decode((function(t){return a(t)}))}))},t.load=function(e){return new t(r.default.readFileSync(e))};var e=t.prototype;return e.read=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=this.data[this.pos++];return e},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){var e=this;return i.default.inflate(this.imgData,(function(a,r){if(a)throw a;var i=0,s=e.width,h=e.height,o=e.pixelBitlength/8,n=Buffer.alloc(s*h*o);function c(t,e,a,c,d){void 0===d&&(d=!1);for(var l=Math.ceil((s-t)/a),f=Math.ceil((h-e)/c),p=o*l,u=d?n:Buffer.alloc(p*f),v=0,g=0;v<f&&i<r.length;){var b,y,w,k,m;switch(r[i++]){case 0:for(w=0;w<p;w++)u[g++]=r[i++];break;case 1:for(w=0;w<p;w++)b=r[i++],k=w<o?0:u[g-o],u[g++]=(b+k)%256;break;case 2:for(w=0;w<p;w++)b=r[i++],y=(w-w%o)/o,m=v&&u[(v-1)*p+y*o+w%o],u[g++]=(m+b)%256;break;case 3:for(w=0;w<p;w++)b=r[i++],y=(w-w%o)/o,k=w<o?0:u[g-o],m=v&&u[(v-1)*p+y*o+w%o],u[g++]=(b+Math.floor((k+m)/2))%256;break;case 4:for(w=0;w<p;w++){var x,D;b=r[i++],y=(w-w%o)/o,k=w<o?0:u[g-o],0===v?m=D=0:(m=u[(v-1)*p+y*o+w%o],D=y&&u[(v-1)*p+(y-1)*o+w%o]);var I=k+m-D,M=Math.abs(I-k),C=Math.abs(I-m),P=Math.abs(I-D);x=M<=C&&M<=P?k:C<=P?m:D,u[g++]=(b+x)%256}break;default:throw new Error("Invalid filter algorithm: "+r[i-1])}if(!d){var S=((e+v*c)*s+t)*o,B=v*p;for(w=0;w<l;w++){for(var T=0;T<o;T++)n[S++]=u[B++];S+=(a-1)*o}}v++}}return 1===e.interlaceMethod?(c(0,0,8,8),c(4,0,8,8),c(0,4,4,8),c(2,0,4,4),c(0,2,2,4),c(1,0,2,2),c(0,1,1,2)):c(0,0,1,1,!0),t(n)}))},e.decodePalette=function(){for(var t=this.palette,e=t.length,a=this.transparency.indexed||[],r=Buffer.alloc(a.length+e),i=0,s=0,h=0;h<e;h+=3){var o;r[i++]=t[h],r[i++]=t[h+1],r[i++]=t[h+2],r[i++]=null!=(o=a[s++])?o:255}return r},e.copyToImageData=function(t,e){var a,r,i=this.colors,s=null,h=this.hasAlphaChannel;this.palette.length&&(s=this._decodedPalette||(this._decodedPalette=this.decodePalette()),i=4,h=!0);var o=t.data||t,n=o.length,c=s||e,d=a=0;if(1===i)for(;d<n;){r=s?4*e[d/4]:a;var l=c[r++];o[d++]=l,o[d++]=l,o[d++]=l,o[d++]=h?c[r++]:255,a=r}else for(;d<n;)r=s?4*e[d/4]:a,o[d++]=c[r++],o[d++]=c[r++],o[d++]=c[r++],o[d++]=h?c[r++]:255,a=r},e.decode=function(t){var e=this,a=Buffer.alloc(this.width*this.height*4);return this.decodePixels((function(r){return e.copyToImageData(a,r),t(a)}))},t}();exports.default=s;
